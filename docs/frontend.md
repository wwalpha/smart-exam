# フロントエンド 画面設計書

本書は [要件定義_v1.2.md](../要件定義_v1.2.md) をベースに、Smart Exam のフロントエンド画面一覧、ルーティング、画面詳細を定義します。

- Backend API 定義: [docs/backend_api.md](backend_api.md)
- Swagger 定義: [docs/swagger.yml](swagger.yml)
- 技術スタック: [docs/tech_stack.md](tech_stack.md)

---

## 目次

1. [画面一覧（MVP）](#1-画面一覧mvp)
2. [画面一覧（将来拡張）](#2-画面一覧将来拡張)
3. [ルーティング定義](#3-ルーティング定義)
4. [画面詳細](#4-画面詳細)
5. [共通UIコンポーネント](#5-共通uiコンポーネント)
6. [データ取得方針](#6-データ取得方針)
7. [主要ユーザーフロー](#7-主要ユーザーフロー)
8. [要件との差分・前提事項](#8-要件との差分前提事項)

---

## 1. 画面一覧（MVP）

### 1.1 ダッシュボード
| 画面名 | 目的 | 主要表示内容 |
|--------|------|--------------|
| ダッシュボード | システム全体の概要表示 | 本日実施予定のテスト数、不正解率が高い問題・漢字、ロック中の在庫数 |

### 1.2 教材管理
| 画面名 | 目的 | 主要表示内容 |
|--------|------|--------------|
| 教材セット一覧 | 登録済み教材の検索・一覧表示 | 教材名、科目、実施日、回・テスト名、学年、教材種別 |
| 教材セット登録/編集 | 教材メタデータ・ファイルの登録 | 教材名、科目、実施日、ファイルアップロード、プレビュー |
| 教材セット詳細 | 教材内容の確認・問題番号登録 | メタデータ、登録済みファイル、問題番号一覧 |

### 1.3 問題・漢字管理
| 画面名 | 目的 | 主要表示内容 |
|--------|------|--------------|
| 問題登録/編集（教材セット配下） | 教材内の問題番号を登録・編集 | displayLabel、canonicalKey、科目、分野、手動追加/削除 |
| 問題番号候補確定UI | スキャン結果の候補を確定 | 自動生成された候補一覧、手動修正、追加/削除 |
| 漢字マスタ一覧 | 漢字の一覧・検索 | 漢字、よみ、意味、科目、出典 |
| 漢字登録/編集 | 漢字の個別登録・編集 | 漢字、よみ、意味、科目、出典/メモ |
| 漢字一括インポート | .txtファイルから漢字を一括登録 | ファイルアップロード、検証レポート（成功/重複/エラー） |

### 1.4 復習テスト
| 画面名 | 目的 | 主要表示内容 |
|--------|------|--------------|
| 復習テスト一覧（問題） | 問題の復習テスト一覧 | TestID、作成日、科目、出題数、ステータス |
| 復習テスト一覧（漢字） | 漢字の復習テスト一覧 | TestID、作成日、科目、出題数、ステータス |
| 復習テスト生成 | 新規テスト生成 | 科目選択、出題数指定、対象期間、生成結果表示 |
| 復習テスト詳細 | テスト内容の確認・編集 | 出題項目一覧、元教材へのリンク、ステータス変更 |
| 復習テスト結果入力 | テスト結果を一括入力 | 全問正解/不正解一括、個別チェック、実施日指定 |

### 1.5 印刷・PDF
| 画面名 | 目的 | 主要表示内容 |
|--------|------|--------------|
| 漢字テストPDFプレビュー | 漢字テストのPDF生成・印刷 | 問題用PDF、解答用PDF、テンプレ設定 |
| 問題テストPDFプレビュー | 問題テストの参照用PDF生成 | 問題番号一覧、元教材情報 |
| PDFテンプレート設定 | 漢字テストPDFのレイアウト設定 | 用紙サイズ、余白、行数/列数、フォント |

### 1.6 検索
| 画面名 | 目的 | 主要表示内容 |
|--------|------|--------------|
| 問題番号検索 | 問題番号から教材を探す | 科目、問題番号入力、候補教材一覧 |

---

## 2. 画面一覧（将来拡張）

以下は要件定義に含まれているが、MVPでは実装しない機能です。

| 画面名 | 目的 | 備考 |
|--------|------|------|
| 問題番号自動抽出（SAPIX） | SAPIX答案用紙から問題番号を自動抽出 | Phase 2（AI/OCR処理） |
| 問題番号自動抽出（四谷） | 四谷解答から問題番号を自動抽出 | Phase 2（AI/OCR処理） |
| ダッシュボード拡張 | より詳細な分析・グラフ表示 | Phase 3 |
| 手動ロック解除UI | ロック済み対象の手動解除 | 将来拡張（要件では不要と記載） |

---

## 3. ルーティング定義

### 3.1 ルーティングテーブル

| パス | 画面名 | 備考 |
|------|--------|------|
| `/` | ダッシュボード | トップページ |
| `/materials` | 教材セット一覧 | 検索・フィルタ機能 |
| `/materials/new` | 教材セット登録 | 新規登録フォーム |
| `/materials/:materialsetid` | 教材セット詳細 | 詳細表示・編集 |
| `/materials/:materialsetid/questions` | 問題登録/編集 | 教材配下の問題管理 |
| `/materials/:materialsetid/questions/scan` | 問題番号候補確定UI | スキャン結果の確定 |
| `/kanji` | 漢字マスタ一覧 | 漢字の一覧・検索 |
| `/kanji/new` | 漢字登録 | 個別登録フォーム |
| `/kanji/import` | 漢字一括インポート | .txtファイルアップロード |
| `/kanji/:kanjiid` | 漢字編集 | 個別編集フォーム |
| `/reviewtests/questions` | 復習テスト一覧（問題） | 問題テストの一覧 |
| `/reviewtests/questions/new` | 復習テスト生成（問題） | 問題テスト生成フォーム |
| `/reviewtests/questions/:testid` | 復習テスト詳細（問題） | テスト内容表示 |
| `/reviewtests/questions/:testid/grading` | 復習テスト結果入力（問題） | 結果入力フォーム |
| `/reviewtests/questions/:testid/pdf` | 問題テストPDFプレビュー | PDF生成・印刷 |
| `/reviewtests/kanji` | 復習テスト一覧（漢字） | 漢字テストの一覧 |
| `/reviewtests/kanji/new` | 復習テスト生成（漢字） | 漢字テスト生成フォーム |
| `/reviewtests/kanji/:testid` | 復習テスト詳細（漢字） | テスト内容表示 |
| `/reviewtests/kanji/:testid/grading` | 復習テスト結果入力（漢字） | 結果入力フォーム |
| `/reviewtests/kanji/:testid/pdf` | 漢字テストPDFプレビュー | PDF生成・印刷 |
| `/search/questions` | 問題番号検索 | 問題番号から教材検索 |
| `/settings/pdf` | PDFテンプレート設定 | 漢字PDFのレイアウト設定 |

### 3.2 ルーティング階層（概念図）

```
/
├── / (ダッシュボード)
├── /materials (教材管理)
│   ├── /materials (一覧)
│   ├── /materials/new (登録)
│   └── /materials/:materialsetid (詳細)
│       └── /materials/:materialsetid/questions (問題管理)
│           └── /materials/:materialsetid/questions/scan (候補確定)
├── /kanji (漢字管理)
│   ├── /kanji (一覧)
│   ├── /kanji/new (登録)
│   ├── /kanji/import (一括インポート)
│   └── /kanji/:kanjiid (編集)
├── /reviewtests (復習テスト)
│   ├── /reviewtests/questions (問題テスト)
│   │   ├── /reviewtests/questions (一覧)
│   │   ├── /reviewtests/questions/new (生成)
│   │   └── /reviewtests/questions/:testid (詳細)
│   │       ├── /reviewtests/questions/:testid/grading (結果入力)
│   │       └── /reviewtests/questions/:testid/pdf (PDF)
│   └── /reviewtests/kanji (漢字テスト)
│       ├── /reviewtests/kanji (一覧)
│       ├── /reviewtests/kanji/new (生成)
│       └── /reviewtests/kanji/:testid (詳細)
│           ├── /reviewtests/kanji/:testid/grading (結果入力)
│           └── /reviewtests/kanji/:testid/pdf (PDF)
├── /search (検索)
│   └── /search/questions (問題番号検索)
└── /settings (設定)
    └── /settings/pdf (PDFテンプレート設定)
```

---

## 4. 画面詳細

### 4.1 ダッシュボード (`/`)

#### 目的
- システム全体の状況を一目で確認できる
- 本日実施予定のテスト、不正解率の高い問題・漢字を把握する

#### 主要UI
- 本日実施予定のテスト数（カード表示）
- 不正解率が高い上位5件（問題）
- 不正解率が高い上位5件（漢字）
- ロック中の問題数・漢字数（任意表示）
- テスト生成可能な在庫数（任意表示）

#### 主要操作
- 各テスト一覧へのリンク
- 問題・漢字詳細へのリンク

#### 入出力（API想定）
- **GET** `/v1/dashboard` : ダッシュボード情報取得
  - Response: 本日のテスト数、不正解率ランキング、在庫数等

---

### 4.2 教材セット一覧 (`/materials`)

#### 目的
- 登録済み教材を検索・一覧表示する
- 教材セットの新規登録へ遷移する

#### 主要UI
- 検索フォーム（科目、学年、教材名、実施日範囲、回・テスト名、単元、コース/クラス、キーワード）
- 教材セット一覧テーブル（教材名、科目、実施日、回・テスト名、学年、教材種別）
- 新規登録ボタン
- 各行に「詳細」「問題管理」リンク

#### 主要操作
- 検索条件入力・実行
- 新規登録画面へ遷移
- 教材セット詳細へ遷移
- 問題管理画面へ遷移

#### 入出力（API想定）
- **GET** `/v1/materialsets?subject={subject}&grade={grade}&...` : 教材セット一覧取得
  - Query: 科目、学年、教材名、実施日範囲、回・テスト名、単元、コース/クラス、キーワード
  - Response: 教材セット一覧（メタデータ）

---

### 4.3 教材セット登録/編集 (`/materials/new`, `/materials/:materialsetid`)

#### 目的
- 教材セットのメタデータとファイルを登録・編集する

#### 主要UI
- 必須項目：教材名、科目（算数/国語/理科/社会）、実施日
- 任意項目：学年、回・テスト名、教材種別（SAPIX/四谷）、単元、教室/コース/クラス、メモ、追加キーワード
- ファイルアップロード（PDF/JPG/PNG）：問題用紙、解答、答案（SAPIXのみ）
- ファイルプレビュー（ページ単位）
- 保存ボタン、キャンセルボタン

#### 主要操作
- フォーム入力
- ファイルアップロード（複数可）
- プレビュー表示
- 保存実行

#### 入出力（API想定）
- **POST** `/v1/files/presignupload` : ファイルアップロード用URL取得
  - Request: ファイル名、MIMEタイプ
  - Response: 署名付きURL、S3キー
- **POST** `/v1/materialsets` : 教材セット登録
  - Request: メタデータ、ファイルキー一覧
  - Response: materialSetId
- **PUT** `/v1/materialsets/:materialsetid` : 教材セット更新
  - Request: メタデータ、追加ファイルキー一覧
  - Response: 成功/失敗
- **GET** `/v1/materialsets/:materialsetid` : 教材セット詳細取得
  - Response: メタデータ、ファイル一覧

---

### 4.4 教材セット詳細 (`/materials/:materialsetid`)

#### 目的
- 教材セットの詳細情報を確認する
- 問題番号管理へ遷移する

#### 主要UI
- メタデータ表示（教材名、科目、実施日、学年、教材種別等）
- 登録済みファイル一覧（プレビューリンク）
- 問題番号一覧（displayLabel、canonicalKey、科目、分野）
- 「問題管理」ボタン
- 「編集」ボタン

#### 主要操作
- 問題管理画面へ遷移
- 編集画面へ遷移
- ファイルプレビュー

#### 入出力（API想定）
- **GET** `/v1/materialsets/:materialsetid` : 教材セット詳細取得
- **GET** `/v1/materialsets/:materialsetid/questions` : 教材内の問題一覧取得

---

### 4.5 問題登録/編集 (`/materials/:materialsetid/questions`)

#### 目的
- 教材セット配下の問題番号を手動で登録・編集する
- スキャン/OCRによる候補生成へ遷移する

#### 主要UI
- 問題番号一覧テーブル（displayLabel、canonicalKey、科目、分野）
- 「手動追加」ボタン
- 「スキャン候補確定」ボタン（Phase 2）
- 各行に「編集」「削除」ボタン

#### 主要操作
- 問題番号の手動追加（displayLabel、canonicalKey、科目、分野入力）
- 問題番号の編集（displayLabel、canonicalKey修正）
- 問題番号の削除
- スキャン候補確定画面へ遷移（Phase 2）

#### 入出力（API想定）
- **GET** `/v1/materialsets/:materialsetid/questions` : 問題一覧取得
- **POST** `/v1/materialsets/:materialsetid/questions` : 問題追加
  - Request: displayLabel、canonicalKey、科目、分野
  - Response: questionId
- **PUT** `/v1/questions/:questionid` : 問題更新
  - Request: displayLabel、canonicalKey、科目、分野
  - Response: 成功/失敗
- **DELETE** `/v1/questions/:questionid` : 問題削除
  - Response: 成功/失敗

---

### 4.6 問題番号候補確定UI (`/materials/:materialsetid/questions/scan`)

#### 目的
- スキャン/OCRで自動生成された問題番号候補を確定する（Phase 2）

#### 主要UI
- 候補一覧テーブル（displayLabel候補、canonicalKey候補、信頼度）
- 各行に「承認」「修正」「削除」ボタン
- 「手動追加」ボタン
- 「一括確定」ボタン

#### 主要操作
- 候補の個別承認
- 候補の修正（displayLabel、canonicalKey）
- 候補の削除
- 手動で追加
- 一括確定

#### 入出力（API想定）
- **GET** `/v1/materialsets/:materialsetid/questions/candidates` : 候補一覧取得
  - Response: 候補一覧（displayLabel、canonicalKey、信頼度）
- **POST** `/v1/materialsets/:materialsetid/questions/candidates/confirm` : 候補確定
  - Request: 確定する候補一覧
  - Response: 成功/失敗

---

### 4.7 漢字マスタ一覧 (`/kanji`)

#### 目的
- 漢字マスタを一覧表示・検索する
- 個別登録・一括インポートへ遷移する

#### 主要UI
- 検索フォーム（漢字、よみ、科目）
- 漢字一覧テーブル（漢字、よみ、意味、科目、出典）
- 「新規登録」ボタン
- 「一括インポート」ボタン
- 各行に「編集」「削除」ボタン

#### 主要操作
- 検索条件入力・実行
- 新規登録画面へ遷移
- 一括インポート画面へ遷移
- 漢字編集画面へ遷移
- 漢字削除

#### 入出力（API想定）
- **GET** `/v1/kanji?q={漢字}&yomi={よみ}&subject={科目}` : 漢字一覧取得
  - Query: 漢字、よみ、科目
  - Response: 漢字一覧
- **DELETE** `/v1/kanji/:kanjiid` : 漢字削除
  - Response: 成功/失敗

---

### 4.8 漢字登録/編集 (`/kanji/new`, `/kanji/:kanjiid`)

#### 目的
- 漢字を個別に登録・編集する

#### 主要UI
- 必須項目：漢字
- 任意項目：よみ、意味、科目（国語/社会）、出典/メモ
- 保存ボタン、キャンセルボタン

#### 主要操作
- フォーム入力
- 保存実行

#### 入出力（API想定）
- **POST** `/v1/kanji` : 漢字登録
  - Request: 漢字、よみ、意味、科目、出典/メモ
  - Response: kanjiId
- **PUT** `/v1/kanji/:kanjiid` : 漢字更新
  - Request: 漢字、よみ、意味、科目、出典/メモ
  - Response: 成功/失敗
- **GET** `/v1/kanji/:kanjiid` : 漢字詳細取得
  - Response: 漢字、よみ、意味、科目、出典/メモ

---

### 4.9 漢字一括インポート (`/kanji/import`)

#### 目的
- .txtファイルから漢字を一括登録する

#### 主要UI
- ファイルアップロード（.txt）
- 重複時の挙動選択（スキップ/更新）
- インポート実行ボタン
- 検証レポート表示（成功件数、重複件数、エラー件数、エラー詳細）

#### 主要操作
- ファイルアップロード
- 重複時の挙動選択
- インポート実行
- 検証レポート確認

#### 入出力（API想定）
- **POST** `/v1/kanji/import` : 漢字一括インポート
  - Request: ファイル内容、重複時の挙動
  - Response: 成功件数、重複件数、エラー件数、エラー詳細

---

### 4.10 復習テスト一覧 (問題) (`/reviewtests/questions`)

#### 目的
- 問題の復習テストを一覧表示する
- テスト生成へ遷移する

#### 主要UI
- 検索フォーム（科目、作成日範囲、ステータス）
- テスト一覧テーブル（TestID、作成日、科目、出題数、ステータス）
- 「新規生成」ボタン
- 各行に「詳細」「結果入力」「PDF」「削除」ボタン

#### 主要操作
- 検索条件入力・実行
- テスト生成画面へ遷移
- テスト詳細画面へ遷移
- 結果入力画面へ遷移
- PDF生成画面へ遷移
- テスト削除

#### 入出力（API想定）
- **GET** `/v1/reviewtests/questions?subject={科目}&status={ステータス}&...` : テスト一覧取得
  - Query: 科目、作成日範囲、ステータス
  - Response: テスト一覧
- **DELETE** `/v1/reviewtests/:testid` : テスト削除
  - Response: 成功/失敗

---

### 4.11 復習テスト一覧 (漢字) (`/reviewtests/kanji`)

#### 目的
- 漢字の復習テストを一覧表示する
- テスト生成へ遷移する

#### 主要UI
- 検索フォーム（科目、作成日範囲、ステータス）
- テスト一覧テーブル（TestID、作成日、科目、出題数、ステータス）
- 「新規生成」ボタン
- 各行に「詳細」「結果入力」「PDF」「削除」ボタン

#### 主要操作
- 検索条件入力・実行
- テスト生成画面へ遷移
- テスト詳細画面へ遷移
- 結果入力画面へ遷移
- PDF生成画面へ遷移
- テスト削除

#### 入出力（API想定）
- **GET** `/v1/reviewtests/kanji?subject={科目}&status={ステータス}&...` : テスト一覧取得
  - Query: 科目、作成日範囲、ステータス
  - Response: テスト一覧
- **DELETE** `/v1/reviewtests/:testid` : テスト削除
  - Response: 成功/失敗

---

### 4.12 復習テスト生成 (問題) (`/reviewtests/questions/new`)

#### 目的
- 新規問題復習テストを生成する

#### 主要UI
- 科目選択（算数/国語/理科/社会）
- 出題数指定
- 対象期間選択（直近N日/全期間）
- 生成結果表示（指定件数、生成件数、不足数）
- 生成ボタン

#### 主要操作
- 科目選択
- 出題数入力
- 対象期間選択
- 生成実行
- 生成結果確認
- テスト詳細へ遷移

#### 入出力（API想定）
- **POST** `/v1/reviewtests/questions` : 問題テスト生成
  - Request: 科目、出題数、対象期間
  - Response: testId、指定件数、生成件数、不足数

---

### 4.13 復習テスト生成 (漢字) (`/reviewtests/kanji/new`)

#### 目的
- 新規漢字復習テストを生成する

#### 主要UI
- 科目選択（国語/社会）
- 出題数指定
- 対象期間選択（直近N日/全期間）
- 生成結果表示（指定件数、生成件数、不足数）
- 生成ボタン

#### 主要操作
- 科目選択
- 出題数入力
- 対象期間選択
- 生成実行
- 生成結果確認
- テスト詳細へ遷移

#### 入出力（API想定）
- **POST** `/v1/reviewtests/kanji` : 漢字テスト生成
  - Request: 科目、出題数、対象期間
  - Response: testId、指定件数、生成件数、不足数

---

### 4.14 復習テスト詳細 (問題) (`/reviewtests/questions/:testid`)

#### 目的
- 問題テストの詳細内容を確認する
- 元教材へ遷移する

#### 主要UI
- テスト情報（TestID、作成日、科目、出題数、ステータス）
- 出題項目一覧テーブル（displayLabel、canonicalKey、元教材名、実施日、回・テスト名）
- 各行に「教材へ」リンク
- 「結果入力」ボタン
- 「PDF生成」ボタン
- 「ステータス変更」ボタン（COMPLETED/PAUSED/CANCELED）
- 「削除」ボタン

#### 主要操作
- 出題項目一覧確認
- 元教材へ遷移
- 結果入力画面へ遷移
- PDF生成画面へ遷移
- ステータス変更
- テスト削除

#### 入出力（API想定）
- **GET** `/v1/reviewtests/:testid` : テスト詳細取得
  - Response: テスト情報、出題項目一覧、元教材情報
- **PUT** `/v1/reviewtests/:testid/status` : ステータス変更
  - Request: status（COMPLETED/PAUSED/CANCELED）
  - Response: 成功/失敗

---

### 4.15 復習テスト詳細 (漢字) (`/reviewtests/kanji/:testid`)

#### 目的
- 漢字テストの詳細内容を確認する

#### 主要UI
- テスト情報（TestID、作成日、科目、出題数、ステータス）
- 出題項目一覧テーブル（漢字、よみ、意味）
- 「結果入力」ボタン
- 「PDF生成」ボタン
- 「ステータス変更」ボタン（COMPLETED/PAUSED/CANCELED）
- 「削除」ボタン

#### 主要操作
- 出題項目一覧確認
- 結果入力画面へ遷移
- PDF生成画面へ遷移
- ステータス変更
- テスト削除

#### 入出力（API想定）
- **GET** `/v1/reviewtests/:testid` : テスト詳細取得
  - Response: テスト情報、出題項目一覧
- **PUT** `/v1/reviewtests/:testid/status` : ステータス変更
  - Request: status（COMPLETED/PAUSED/CANCELED）
  - Response: 成功/失敗

---

### 4.16 復習テスト結果入力 (問題) (`/reviewtests/questions/:testid/grading`)

#### 目的
- 問題テストの結果を一括入力する

#### 主要UI
- 出題項目一覧テーブル（displayLabel、canonicalKey、結果選択）
- 「全問正解」ボタン（一括で正解にセット）
- 各行にチェックボックス（不正解のみチェック）
- 「チェックした問題を不正解にする」ボタン
- 実施日入力（デフォルト当日）
- 「保存」ボタン

#### 主要操作
- 全問正解一括セット
- 不正解のみチェック
- 不正解一括セット
- 実施日指定
- 保存実行

#### 入出力（API想定）
- **POST** `/v1/reviewtests/:testid/attempts` : 結果一括登録
  - Request: 各問題の結果（正解/不正解）、実施日
  - Response: 成功/失敗

---

### 4.17 復習テスト結果入力 (漢字) (`/reviewtests/kanji/:testid/grading`)

#### 目的
- 漢字テストの結果を一括入力する

#### 主要UI
- 出題項目一覧テーブル（漢字、よみ、結果選択）
- 「全問正解」ボタン（一括で正解にセット）
- 各行にチェックボックス（不正解のみチェック）
- 「チェックした漢字を不正解にする」ボタン
- 実施日入力（デフォルト当日）
- 「保存」ボタン

#### 主要操作
- 全問正解一括セット
- 不正解のみチェック
- 不正解一括セット
- 実施日指定
- 保存実行

#### 入出力（API想定）
- **POST** `/v1/reviewtests/:testid/kanjiattempts` : 結果一括登録
  - Request: 各漢字の結果（正解/不正解）、実施日
  - Response: 成功/失敗

---

### 4.18 漢字テストPDFプレビュー (`/reviewtests/kanji/:testid/pdf`)

#### 目的
- 漢字テストのPDFを生成・印刷する

#### 主要UI
- 「問題用PDF」ボタン
- 「解答用PDF」ボタン
- PDFプレビュー表示
- 「印刷」ボタン（ブラウザ印刷）
- 「テンプレ設定」リンク

#### 主要操作
- 問題用PDF生成
- 解答用PDF生成
- PDFプレビュー
- ブラウザ印刷
- テンプレ設定画面へ遷移

#### 入出力（API想定）
- **GET** `/v1/reviewtests/:testid/pdf?type={問題|解答}` : PDF生成
  - Query: type（問題/解答）
  - Response: PDF URL

---

### 4.19 問題テストPDFプレビュー (`/reviewtests/questions/:testid/pdf`)

#### 目的
- 問題テストの参照用PDFを生成・印刷する

#### 主要UI
- PDFプレビュー表示（TestID、作成日、科目、問題番号一覧、元教材情報）
- 「印刷」ボタン（ブラウザ印刷）

#### 主要操作
- PDFプレビュー
- ブラウザ印刷

#### 入出力（API想定）
- **GET** `/v1/reviewtests/:testid/pdf` : PDF生成
  - Response: PDF URL

---

### 4.20 問題番号検索 (`/search/questions`)

#### 目的
- 問題番号から該当する教材を検索する

#### 主要UI
- 科目選択（算数/国語/理科/社会）
- 問題番号入力（displayLabel または canonicalKey）
- 検索ボタン
- 候補教材一覧テーブル（教材種別、教材名、実施日、回・テスト名、学年、該当問題番号）
- 各行に「教材へ」リンク

#### 主要操作
- 科目選択
- 問題番号入力
- 検索実行
- 候補教材一覧確認
- 教材詳細へ遷移

#### 入出力（API想定）
- **GET** `/v1/search/questions?subject={科目}&number={問題番号}` : 問題番号検索
  - Query: 科目、問題番号
  - Response: 候補教材一覧

---

### 4.21 PDFテンプレート設定 (`/settings/pdf`)

#### 目的
- 漢字テストPDFのレイアウト設定を保存する

#### 主要UI
- 用紙サイズ選択（A4/B5等）
- 余白設定（上下左右）
- 行数/列数設定
- マス目サイズ設定
- フォントサイズ設定
- タイトルON/OFF
- ヘッダ項目選択（TestID/作成日/科目/教材名等）
- 「保存」ボタン
- 「プレビュー」ボタン

#### 主要操作
- 各種設定変更
- プレビュー表示
- 保存実行

#### 入出力（API想定）
- **GET** `/v1/settings/pdf` : PDFテンプレ設定取得
  - Response: 設定内容
- **PUT** `/v1/settings/pdf` : PDFテンプレ設定保存
  - Request: 設定内容
  - Response: 成功/失敗

---

## 5. 共通UIコンポーネント

### 5.1 レイアウト
- **AppLayout**: サイドバー + ヘッダー + メインコンテンツ
- **Sidebar**: ナビゲーションメニュー
- **Header**: ページタイトル、ユーザー情報

### 5.2 フォーム
- **Input**: テキスト入力
- **Select**: プルダウン選択
- **DatePicker**: 日付選択
- **FileUpload**: ファイルアップロード
- **Checkbox**: チェックボックス
- **RadioGroup**: ラジオボタングループ

### 5.3 表示
- **Table**: データテーブル（ソート/ページング対応）
- **Card**: カード表示
- **Badge**: ステータスバッジ
- **Button**: ボタン（Primary/Secondary/Danger）
- **Dialog**: モーダルダイアログ
- **Toast**: 通知メッセージ

### 5.4 ナビゲーション
- **Breadcrumb**: パンくずリスト
- **Tabs**: タブ切り替え
- **Pagination**: ページネーション

---

## 6. データ取得方針

### 6.1 状態管理
- グローバルな状態管理には **Zustand** を使用
- Zustand store は slice 方式で実装（`createXxxSlice` を定義し、`create()` で結合）
- API 呼び出しは Zustand 側に集約し、コンポーネントから直接呼び出さない

### 6.2 API通信
- API クライアントは `frontend/src/services` に集約
- Request/Response 型は `frontend/typings` に定義（空でもペアで定義）
- エラーハンドリングは共通関数で処理

### 6.3 ファイルアップロード
- S3 署名付きURLを取得（`POST /v1/files/presignupload`）
- クライアントから直接S3へアップロード
- アップロード完了後、S3キーをAPI経由でバックエンドへ送信

### 6.4 ファイルダウンロード
- S3 署名付きURLを取得（`POST /v1/files/presigndownload`）
- クライアントから直接S3へアクセス

---

## 7. 主要ユーザーフロー

### 7.1 フロー1: 教材アップロード → 問題登録 → 復習テスト生成 → 結果入力

```
1. 教材セット登録
   ↓
   /materials/new で教材メタデータ・ファイルをアップロード
   ↓
2. 問題番号登録
   ↓
   /materials/:materialsetid/questions で問題番号を手動登録
   ↓
3. 復習テスト生成
   ↓
   /reviewtests/questions/new で科目・出題数を指定してテスト生成
   ↓
4. テスト詳細確認
   ↓
   /reviewtests/questions/:testid でテスト内容を確認
   ↓
5. PDF生成・印刷（任意）
   ↓
   /reviewtests/questions/:testid/pdf でPDF生成・印刷
   ↓
6. テスト実施（オフライン）
   ↓
7. 結果入力
   ↓
   /reviewtests/questions/:testid/grading で結果を一括入力
   ↓
8. ダッシュボード確認
   ↓
   / で不正解率ランキング・次回テスト予定を確認
```

### 7.2 フロー2: 漢字登録 → 復習テスト生成 → 結果入力

```
1. 漢字一括インポート
   ↓
   /kanji/import で.txtファイルをアップロード
   ↓
2. 復習テスト生成
   ↓
   /reviewtests/kanji/new で科目・出題数を指定してテスト生成
   ↓
3. テスト詳細確認
   ↓
   /reviewtests/kanji/:testid でテスト内容を確認
   ↓
4. PDF生成・印刷
   ↓
   /reviewtests/kanji/:testid/pdf で問題用PDF・解答用PDFを生成・印刷
   ↓
5. テスト実施（オフライン）
   ↓
6. 結果入力
   ↓
   /reviewtests/kanji/:testid/grading で結果を一括入力
   ↓
7. ダッシュボード確認
   ↓
   / で不正解率ランキング・次回テスト予定を確認
```

### 7.3 フロー3: 問題番号から教材を探す

```
1. 問題番号検索
   ↓
   /search/questions で科目・問題番号を入力
   ↓
2. 候補教材一覧確認
   ↓
   候補教材一覧から該当教材を選択
   ↓
3. 教材詳細へ遷移
   ↓
   /materials/:materialsetid で教材詳細・ファイルプレビューを確認
```

---

## 8. 要件との差分・前提事項

### 8.1 要件定義との整合性

本ドキュメントは [要件定義_v1.2.md](../要件定義_v1.2.md) のユースケースを網羅しています。

- **教材管理**（4章）→ 画面4.2〜4.5で対応
- **問題・漢字登録**（5章）→ 画面4.5〜4.9で対応
- **復習テスト生成・削除**（8章）→ 画面4.10〜4.17で対応
- **印刷・PDF出力**（9章）→ 画面4.18〜4.19、4.21で対応
- **教材検索（問題番号から探す）**（10章）→ 画面4.20で対応
- **ダッシュボード**（11章）→ 画面4.1で対応

### 8.2 実装フェーズとの対応

- **Phase 1（MVP）**: 画面4.1〜4.21のうち、スキャン/OCR関連（4.6）を除く全機能
- **Phase 2**: 画面4.6（問題番号候補確定UI）
- **Phase 3**: ダッシュボード拡張、漢字PDF詳細設定

### 8.3 前提事項

- 教材ファイルは物理削除しない（要件8.6に従う）
- ロックは内部保持のみで、ユーザーへの可視化は不要（要件8.4）
- 手動ロック解除機能は提供しない（要件8.5）
- テスト削除時はロックを全解除する（要件8.6）
- 問題番号の正規化ルールは要件3.4に従う
- 復習スケジュール（dueDate）は要件7.4のルールに従う
- テスト生成の選択順は要件8.3のルールに従う（dueDate昇順 → 最終実施日昇順 → ID昇順）

### 8.4 要件側へのフィードバック候補

以下は要件定義に明示されていないが、実装時に検討が必要な項目です。

- **認証・ユーザー管理**: 要件12章で「ユーザー単位でアクセス制御」と記載があるが、ログイン/ユーザー管理画面の詳細は未定義
- **エラーハンドリング**: API エラー時の画面表示方針（トースト/モーダル/インライン等）は要件に明示なし
- **レスポンシブ対応**: タブレット/スマホ対応の要否は要件に明示なし
- **ページング**: 一覧画面のページングサイズ（デフォルト件数）は要件に明示なし
- **ソート**: 一覧画面のソート項目・デフォルトソート順は要件に明示なし
- **教材削除**: 要件4.1で「削除は提供しない」と記載があるが、誤登録時の運用方針は未定義
- **テストの再実施**: 一度実施したテストを再度実施する場合の運用（履歴追加 or 新規テスト生成）は未定義

---

## 9. まとめ

本ドキュメントは、要件定義_v1.2.md をベースに、Smart Exam のフロントエンド画面を体系的に整理しました。

- **画面数**: MVP で21画面（うちPhase 2が1画面）
- **ルート数**: 21ルート
- **主要ユーザーフロー**: 3本（教材アップロード→採点→復習テスト、漢字登録→復習テスト、問題番号検索）

今後の実装時には、本ドキュメントを参照しながら、画面ごとの詳細仕様を詰めていく想定です。
